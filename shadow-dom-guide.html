<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow DOM と Lit - 薄いラッパーの真実</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 0.5em;
            color: #111;
        }

        h2 {
            font-size: 1.8em;
            margin: 2em 0 1em;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.3em;
        }

        h3 {
            font-size: 1.3em;
            margin: 1.5em 0 0.5em;
            color: #444;
        }

        p {
            margin-bottom: 1em;
            color: #666;
            font-size: 1.05em;
        }

        .intro {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .intro h2 {
            color: white;
            border: none;
            margin-top: 0;
        }

        .intro p {
            color: rgba(255, 255, 255, 0.95);
        }

        .highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
        }

        .highlight strong {
            color: #856404;
        }

        .demo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .demo-container {
                grid-template-columns: 1fr;
            }
        }

        .demo-box {
            padding: 20px;
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        pre {
            background: #2a2a2a;
            color: #e8e8e8;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.85em;
            line-height: 1.6;
        }

        pre .comment {
            color: #7c7c7c;
        }

        pre .keyword {
            color: #c792ea;
        }

        pre .string {
            color: #c3e88d;
        }

        pre .function {
            color: #82aaff;
        }

        .comparison-table {
            margin: 30px 0;
            border-collapse: collapse;
            width: 100%;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .mapping {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
        }

        .mapping h3 {
            color: #1976d2;
            margin-top: 0;
        }

        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .code-comparison {
                grid-template-columns: 1fr;
            }
        }

        .code-block {
            position: relative;
        }

        .code-label {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 4px 4px 0 0;
            font-weight: 600;
            font-size: 0.9em;
        }

        .code-label.vanilla {
            background: #ff6b6b;
        }

        .code-label.lit {
            background: #51cf66;
        }

        .arrow {
            text-align: center;
            font-size: 2em;
            color: #667eea;
            margin: 20px 0;
        }

        ul {
            margin-left: 2em;
            margin-bottom: 1em;
        }

        li {
            margin-bottom: 0.5em;
            color: #666;
        }

        .conclusion {
            background: #f8f9fa;
            border: 2px solid #667eea;
            padding: 30px;
            border-radius: 8px;
            margin: 40px 0 20px;
        }

        .conclusion h2 {
            color: #667eea;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Shadow DOM と Lit - 薄いラッパーの真実</h1>

        <div class="intro">
            <h2>Lit は本当に「薄いラッパー」</h2>
            <p>Lit は魔法のフレームワークではありません。ブラウザの標準 Web Components API（Shadow DOM、Custom Elements）に対する薄い便利層です。</p>
            <p>このページでは、素のJavaScriptとLitを並べて比較し、Litがどれだけシンプルなラッパーであるかを示します。</p>
        </div>

        <h2>1. Shadow DOM の基本構造</h2>
        <p>まず、ブラウザ標準のShadow DOMを理解しましょう。Shadow DOMは以下の機能を提供します：</p>

        <ul>
            <li><strong>カプセル化</strong>: スタイルとDOMツリーを外部から隔離</li>
            <li><strong>再利用性</strong>: コンポーネントを独立したユニットとして扱える</li>
            <li><strong>スコープ付きスタイル</strong>: CSSが外部に漏れない</li>
        </ul>

        <div class="highlight">
            <strong>重要:</strong> Shadow DOMはブラウザのネイティブ機能です。Litは単にこれを使いやすくしているだけです。
        </div>

        <h2>2. 素のJavaScript vs Lit - 実装比較</h2>
        <p>同じカウンターコンポーネントを、素のJavaScriptとLitで実装してみましょう。</p>

        <div class="demo-container">
            <div class="demo-box">
                <h3>素のJavaScript版</h3>
                <vanilla-counter></vanilla-counter>
            </div>
            <div class="demo-box">
                <h3>Lit版</h3>
                <lit-counter></lit-counter>
            </div>
        </div>

        <p><strong>見た目も動作も全く同じです。</strong> では、コードを比較してみましょう。</p>

        <h3>素のJavaScriptでの実装（約65行）</h3>
        <pre>class VanillaCounter extends HTMLElement {
  constructor() {
    super();
    <span class="comment">// 1. Shadow DOMを手動で作成</span>
    this.attachShadow({ mode: 'open' });
    this._count = 0;
  }

  connectedCallback() {
    <span class="comment">// 2. スタイルを手動でstyle要素として作成</span>
    const style = document.createElement('style');
    style.textContent = \`
      :host { display: block; }
      button { background: #667eea; color: white; ... }
    \`;

    <span class="comment">// 3. HTML要素を一つずつ手動で作成</span>
    const container = document.createElement('div');
    const title = document.createElement('h3');
    title.textContent = '素のJavaScript版';

    const countDisplay = document.createElement('div');
    countDisplay.textContent = \`カウント: \${this._count}\`;

    const button = document.createElement('button');
    button.textContent = 'クリック';

    <span class="comment">// 4. イベントリスナーを手動で追加</span>
    button.addEventListener('click', () => {
      this._count++;
      <span class="comment">// 5. DOMを手動で更新（重要！）</span>
      countDisplay.textContent = \`カウント: \${this._count}\`;
    });

    <span class="comment">// 6. すべてをShadow DOMに手動で追加</span>
    container.appendChild(title);
    container.appendChild(countDisplay);
    container.appendChild(button);
    this.shadowRoot.appendChild(style);
    this.shadowRoot.appendChild(container);
  }
}</pre>

        <h3>Litでの実装（約40行）</h3>
        <pre>import { LitElement, html, css } from 'lit';

class LitCounter extends LitElement {
  <span class="comment">// 2. スタイルをcssタグで宣言的に定義</span>
  static styles = css\`
    :host { display: block; }
    button { background: #667eea; color: white; ... }
  \`;

  <span class="comment">// リアクティブプロパティ（変更を自動追跡）</span>
  static properties = {
    count: { type: Number }
  };

  constructor() {
    super(); <span class="comment">// 1. Shadow DOMは自動作成</span>
    this.count = 0;
  }

  <span class="comment">// 3. HTMLを宣言的に定義</span>
  render() {
    return html\`
      &lt;div class="container"&gt;
        &lt;h3&gt;Lit版&lt;/h3&gt;
        &lt;div class="count"&gt;カウント: \${this.count}&lt;/div&gt;
        <span class="comment">// 4. イベントも宣言的に</span>
        &lt;button @click=\${() => this.count++}&gt;
          クリック
        &lt;/button&gt;
      &lt;/div&gt;
    \`;
    <span class="comment">// 5. DOMの更新は自動！</span>
  }
}</pre>

        <h2>3. Lit = Shadow DOM + 便利な糖衣構文</h2>

        <div class="mapping">
            <h3>完全な1対1マッピング</h3>
            <p>Litの機能は、すべてブラウザのネイティブAPIに直接マッピングされます：</p>
        </div>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>素のJavaScript（標準API）</th>
                    <th>Lit（薄いラッパー）</th>
                    <th>Litが自動化すること</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>this.attachShadow({mode: 'open'})</code></td>
                    <td><code>class extends LitElement</code></td>
                    <td>✅ Shadow DOMの自動作成</td>
                </tr>
                <tr>
                    <td><code>const style = createElement('style')</code></td>
                    <td><code>static styles = css`...`</code></td>
                    <td>✅ スタイルの注入</td>
                </tr>
                <tr>
                    <td><code>createElement() + appendChild()</code></td>
                    <td><code>html`&lt;div&gt;...&lt;/div&gt;`</code></td>
                    <td>✅ DOM構築</td>
                </tr>
                <tr>
                    <td><code>addEventListener('click', ...)</code></td>
                    <td><code>@click=${...}</code></td>
                    <td>✅ イベントバインディング</td>
                </tr>
                <tr>
                    <td><code>elem.textContent = newValue</code></td>
                    <td><code>this.property = newValue</code></td>
                    <td>✅ 自動再レンダリング</td>
                </tr>
            </tbody>
        </table>

        <h2>4. Litが提供する「薄さ」の証明</h2>

        <div class="highlight">
            <strong>重要な事実:</strong>
            <ul style="margin-top: 10px;">
                <li>Lit は新しいAPIを発明していません</li>
                <li>すべての機能は標準のShadow DOM/Custom Elements APIの上に構築されています</li>
                <li>Litのコンポーネントは、素のJavaScriptで書いたコンポーネントと完全に互換性があります</li>
                <li>仮想DOMは使っていません - 直接Shadow DOMを操作します</li>
            </ul>
        </div>

        <h3>Litが削減するボイラープレート</h3>
        <ol>
            <li><strong>手動DOM操作</strong> → 宣言的なHTMLテンプレート</li>
            <li><strong>手動イベント管理</strong> → 自動的なバインディング</li>
            <li><strong>手動再レンダリング</strong> → リアクティブプロパティ</li>
            <li><strong>Shadow DOM初期化</strong> → 自動セットアップ</li>
        </ol>

        <p>しかし、これらはすべて<strong>同じShadow DOMの上で動作</strong>しています。</p>

        <h2>5. コードサイズの比較</h2>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>項目</th>
                    <th>素のJavaScript</th>
                    <th>Lit</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>コード行数</td>
                    <td>~65行</td>
                    <td>~40行（38%削減）</td>
                </tr>
                <tr>
                    <td>手動DOM操作</td>
                    <td>createElement × 4回</td>
                    <td>0回</td>
                </tr>
                <tr>
                    <td>手動appendChild</td>
                    <td>5回</td>
                    <td>0回</td>
                </tr>
                <tr>
                    <td>手動更新ロジック</td>
                    <td>必要</td>
                    <td>自動</td>
                </tr>
                <tr>
                    <td>Litライブラリサイズ</td>
                    <td>-</td>
                    <td>~5KB (gzip)</td>
                </tr>
            </tbody>
        </table>

        <div class="conclusion">
            <h2>結論: Litは本当に薄いラッパー</h2>
            <p>Litはブラウザの標準Web Components APIを<strong>置き換える</strong>のではなく、<strong>より使いやすくする</strong>ためのものです。</p>

            <ul>
                <li>✅ 全機能がネイティブAPIに直接マッピング</li>
                <li>✅ ボイラープレートを削減（コード量 -38%）</li>
                <li>✅ 同じShadow DOMを使用</li>
                <li>✅ ライブラリサイズわずか5KB</li>
                <li>✅ 学習コストが低い（Shadow DOMを理解すれば理解できる）</li>
            </ul>

            <p style="margin-top: 20px; font-size: 1.1em;"><strong>Litを学ぶ = Shadow DOMを学ぶ + 便利な糖衣構文を学ぶ</strong></p>
        </div>

        <div style="margin-top: 40px; text-align: center; color: #999;">
            <p><a href="/" style="color: #667eea; text-decoration: none;">← Web コンポーネント入門に戻る</a></p>
        </div>
    </div>

    <script type="module">
        import './src/components/vanilla-counter.js';
        import './src/components/lit-counter.js';
    </script>
</body>
</html>
